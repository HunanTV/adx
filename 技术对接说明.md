# Adx对接步骤及相关问题解答 #

## 1. Adx对接说明  ##
### 1.1 对接步骤 ###
1. 开始对接  
2.  向DSP提供最新的ADX协议文档和接口协议联调工具  
3.  DSP按照协议进行对接开发  
4.  DSP使用接口协议联调工具测试通过  
5.  线下真实环境联调  
6.  线上小流量测试通过  
7.  测试通过  
8.  对接完成  


### 1.2 对接说明 ###
1.  向Dsp提供的资料包括最新的Adx协议文档，接口协议联调工具以及本说明文档 
2.  Dsp在按照协议文档开发后，在使用接口联调工具测试通过后，可以联系芒果技术对接人安排真实环境的联调 
3.  在真实环境联调通过后，联系芒果运营对接人安排线上小流量测试
4.  待以上流程都走通之后，测试通过，可以进行线上投放


----------


## 2. 对接常见问题解答 ##

----------

### 2.1	在返回广告内容的时候，ad_url和creative_id这两个字段怎么使用？ ###
**使用方法是：**  
如果是先审后播的dsp，只需要在素材上传成功后，将生成的id作为creative_id返回即可，不需要再返回ad_url；如果是先审后播的dsp，只需要返回包含http://或者https://的素材地址作为ad_url的值即可，而不用返回creative_id字段。使用creative_id的好处在于：我们会根据请求的不同，自动选择不同端的素材。
素材上传接口中的xy_ratio字段目前只支持: AD_16:9, AD_4:3两种比例，如果不符合这两种比例，则在这两种比例中选择最为接近的一个即可（可能会添加黑边）。
### 2.3	补充最新的分类列表 ###
电影 | 动漫  | 少儿 | 新闻 | 音乐  | 逗爸 | 爱豆 | 乐活  | 纪录片 | 趣玩| 教育|
------------- | -------------  | ------------- | ------------- | -------------   
3  | 50   | 50  | 106  | 20   | 111 | 111  | 105   | 51  | 116 | 115


### 2.4	价格加解密相关 ###
***说明***  
芒果tv PMP平台中，针对价格传输(包括但不限于py上报、第三方监测上报等），采用AES 对称加密。对于加密密钥，直接将字符串强制转换为128byte的二进制使用的。其中：  
   加密算法：AES-128 CBC 方式  
   初始化向量IV：和加密密钥相同  
   BlockSize：16  
   补码方式：PKCS5Padding（padding byte=blockSize len(待加密字符串)%blockSize）  
   加密结果编码方式：16进制 
  
***示例***  
   原价格：2000 (单位是分/CPM)  
   当前时间戳: 1458923683  
   待加密字符串："2000|1482230774"  
   加密密匙："d6797b0f95f8ead1"  
   加密后字符串："3dd5e5b6c16eea4635af0cd9820dda34"       
   代码（golang/c++版）：见附件中的golang/c++版的加解密代码

### 2.5	不参与竞价时无广告时的返回 ###
当Dsp不参与竞价，如果没有广告返回的话，返回格式为：  
`{"version":3,"bid":"ad68e04d-ee12-4f0c-6dff-5900b388aa90","err_code":204}`

###  2.6	DSP接口测试工具使用指南###
在Linux环境下，运行./dsp_check_tool -h 查看帮助,通过该工具可以自助测试magv adx的协议，其中包含的广告类型包括前贴片广告，暂停广告以及通栏广告

### 2.7	space_id, creative_id, adid三者的区别 ###
目前只使用space_id作为广告位Id，是广告位唯一标示，creative_id作为素材唯一标示，Dsp只有在调用芒果的素材上传接口之后，才会生成对应素材的creative_id。

### 2.9  pmp在bid request中会传多个吗？响应的时候是否一定要带上dealid？###
Request中的字段中会带有首选交易相关的信息，如果pmp字段为空，则标示此交易为rtb请求；如果pmp字段不为空，则标示此次请求的是首选交易。首选交易中的pmp字段是数组类型。如果返回的广告是首选交易类型，则返回中必须带有请求中对应的dealid字段。

### 2.10 Dsp请求中的min_playtime, max_playtime的作用 ###
Dsp请求中的min_playtime, max_playtime作用标示可返回时长控制。返回广告的时长必须要在这个时间范围内，即返回广告的时间长度必须要大于等于min_playtime，小于等于 max_playtime。对于一个请求，dsp可以返回这个时间范围内的一只或者多支广告。
